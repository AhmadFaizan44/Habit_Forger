<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>30-Day Habit Tracker ‚Äî Edit & View</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Marcellus:wght@400&display=swap" rel="stylesheet">
<style>
:root{
  --paper:#0f172a;            /* default dark */
  --ink:#e5e7eb;
  --muted:#9aa4b2;
  --line:#1f2a3a;
  --line-strong:#2a3a52;
  --accent:#ffffff08;
  --radius:14px;
  --shadow:0 10px 30px rgba(0,0,0,.35);
  --brand:#0ea5e9;
  --brand-2:#22c55e;
  --grad-angle:135deg;
  --sheet-bg:#0b1220;         /* board background */
}
:root.light{
  --paper:#ffffff;
  --ink:#0b1220;
  --muted:#6b7280;
  --line:#e5e7eb;
  --line-strong:#cbd5e1;
  --accent:#11182706;
  --shadow:0 8px 26px rgba(0,0,0,.08);
  --sheet-bg:#ffffff;
}

/* Base */
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  background:
    radial-gradient(900px 500px at 10% -10%, color-mix(in srgb, var(--brand) 10%, transparent), transparent 60%),
    radial-gradient(900px 500px at 110% 0%, color-mix(in srgb, var(--brand-2) 10%, transparent), transparent 60%),
    var(--paper);
  color:var(--ink);
  font:14px/1.45 "Inter", system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
}
.container{max-width:1400px; margin:28px auto; padding:0 16px}

/* Top bar */
.top{
  display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:14px;
}
.brand{
  display:flex; align-items:center; gap:12px;
}
.logo{
  width:52px; height:52px; border-radius:16px; display:grid; place-items:center;
  background:
    radial-gradient(circle at 30% 30%, color-mix(in srgb, var(--brand) 28%, transparent), transparent 60%),
    radial-gradient(circle at 70% 70%, color-mix(in srgb, var(--brand-2) 28%, transparent), transparent 60%),
    var(--sheet-bg);
  border:1px solid var(--line-strong); box-shadow:var(--shadow);
}
.logo svg{width:26px; height:26px}
h1{margin:0; font-family:"Marcellus", serif; font-size:28px}
h1 small{display:block; color:var(--muted); font:600 12px/1.1 Inter}

/* Mode picker */
.mode-picker{
  display:grid; grid-template-columns:repeat(auto-fit,minmax(240px,1fr)); gap:16px; margin:10px 0 18px;
}
.card{
  background:linear-gradient(180deg, rgba(255,255,255,.5), rgba(255,255,255,.35));
  border:1px solid var(--line-strong); border-radius:16px; padding:16px; box-shadow:var(--shadow);
}
.card .row{display:flex; align-items:center; gap:12px; justify-content:space-between; flex-wrap:wrap}
.badge{font-size:12px; color:var(--muted)}
.btn{
  background:linear-gradient(var(--grad-angle), var(--brand), var(--brand-2));
  color:#fff; border:none; padding:10px 14px; border-radius:12px; font-weight:800; cursor:pointer; box-shadow:var(--shadow)
}
.btn.ghost{background:transparent; color:var(--ink); border:1px solid var(--line-strong); box-shadow:none}
.btn.small{padding:8px 10px; font-weight:700}
.icon-btn{
  background:transparent; border:1px solid var(--line-strong); color:var(--ink);
  padding:8px 10px; border-radius:10px; cursor:pointer
}

/* Controls row (only in Edit) */
.controls{
  display:flex; flex-wrap:wrap; gap:10px; align-items:center; margin:10px 0 14px; color:var(--muted); font-size:12px;
}
.controls .tile{
  display:flex; align-items:center; gap:8px; padding:8px 10px; background:var(--sheet-bg);
  border:1px solid var(--line-strong); border-radius:12px;
}
.controls input[type="color"]{width:34px; height:28px; border:none; background:transparent}
.controls input[type="range"]{accent-color:var(--brand); width:150px}
.swatch{
  width:110px; height:28px; border-radius:10px; border:1px solid var(--line-strong);
  background:linear-gradient(var(--grad-angle), var(--brand), var(--brand-2));
}

/* Sheet board */
.board{
  background:var(--sheet-bg);
  border:1px solid var(--line-strong);
  border-radius:16px; overflow:hidden; box-shadow:var(--shadow);
}
.board-header{
  display:flex; align-items:center; gap:12px; padding:14px 16px;
  border-bottom:1px solid var(--line); background:var(--accent)
}
.progress{flex:1; height:12px; border-radius:999px; border:1px solid var(--line-strong); background:#00000012; overflow:hidden}
.progress i{display:block; height:100%; width:0%; background:linear-gradient(90deg, var(--brand), var(--brand-2))}
.pct{min-width:66px; text-align:right; font-weight:800; color:var(--muted)}

.sheet-wrap{padding:0}
.sheet{
  --name-col: 230px;
  display:grid;
  grid-template-columns: var(--name-col) repeat(30, minmax(28px, 1fr));
  border-top:1px solid var(--line);
  overflow:auto;
}
.cell{
  display:flex; align-items:center; justify-content:center;
  border-right:1px solid var(--line); border-bottom:1px solid var(--line);
  background:transparent; min-height:36px; padding:0;
}
.cell.head{
  position:sticky; top:0; z-index:3;
  background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
  color:var(--muted); font-weight:800; font-size:12px; backdrop-filter:saturate(140%) blur(2px);
}
.cell.name{
  position:sticky; left:0; z-index:2;
  justify-content:flex-start; padding:0 12px; gap:8px;
  background:linear-gradient(90deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
}
.cell.name .rowpct{margin-left:auto; color:var(--muted); font-weight:700}
.cell.head.day{cursor:pointer}
.cell.name .label{cursor:pointer}
.week{background:
  linear-gradient(0deg,
    color-mix(in srgb, var(--brand) 8%, transparent),
    color-mix(in srgb, var(--brand-2) 8%, transparent))}
.cell.weekhead{background:
  linear-gradient(180deg,
    color-mix(in srgb, var(--brand) 14%, transparent),
    rgba(255,255,255,.03))}

/* Full-box checkbox: fills the whole cell */
.fullbox{
  width:100%; height:100%;
  display:block; cursor:pointer; position:relative;
  isolation:isolate;
}
.fullbox input{
  position:absolute; inset:0; width:100%; height:100%;
  opacity:0; cursor:pointer;
}
.fullbox .box{
  position:absolute; inset:4px;        /* padding inside cell */
  border:2px solid #8aa0b5; border-radius:6px;
  background:transparent; transition:.15s ease;
}
.fullbox:hover .box{border-color:#6b86a4}
.fullbox input:checked + .box{
  border-color:transparent;
  background:linear-gradient(var(--grad-angle), var(--brand), var(--brand-2));
  box-shadow:0 0 0 3px color-mix(in srgb, var(--brand) 25%, transparent) inset;
}

/* Task manager (Edit only) */
.taskbar{
  display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin:10px 0 6px;
}
.taskbar input[type="text"]{
  padding:9px 10px; border-radius:10px; border:1px solid var(--line-strong);
  background:var(--sheet-bg); color:var(--ink); width:min(340px, 60vw);
}

/* Footer legend */
.legend{padding:10px 16px; color:var(--muted); font-size:12px; display:flex; gap:18px; flex-wrap:wrap;
  border-top:1px solid var(--line); background:var(--accent)}
.legend b{color:var(--ink)}

/* Utility (hidden when viewing) */
.hidden{display:none !important}

/* Print: print sheet only */
@media print{
  @page{size: A4 landscape; margin:10mm}
  body{background:#fff}
  .container>*:not(.printable){display:none !important}
  .printable{display:block}
  .printable .sheet{border-color:#e5e7eb}
  .printable .cell{border-color:#e5e7eb}
  .printable .cell.head, .printable .cell.name{background:#fff}
}

/* Simple tooltip-ish title look for icon buttons on hover (optional) */
.icon-btn:hover{filter:brightness(1.08)}
</style>
</head>
<body>
  <div class="container">
    <!-- Top bar -->
    <div class="top">
      <div class="brand">
        <div class="logo" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="none" stroke="url(#g)" stroke-width="1.6">
            <defs><linearGradient id="g" x1="0" x2="1"><stop offset="0" stop-color="var(--brand)"/><stop offset="1" stop-color="var(--brand-2)"/></linearGradient></defs>
            <circle cx="12" cy="12" r="9"/>
            <path d="M12 3v18M3 12h18" opacity=".35"/>
          </svg>
        </div>
        <div>
          <h1>30-Day Habit Tracker <small>Select a mode to begin</small></h1>
        </div>
      </div>
      <div class="right">
        <button id="modeEditBtn" class="btn small">‚úèÔ∏è Edit</button>
        <button id="modeViewBtn" class="btn ghost small">üëÅÔ∏è View</button>
        <button id="toggleTheme" class="icon-btn" title="Light / Dark">üåì</button>
        <button id="fullscreenBtn" class="icon-btn" title="Fullscreen">‚õ∂</button>
      </div>
    </div>

    <!-- Mode picker cards -->
    <div id="modePicker" class="mode-picker">
      <div class="card">
        <div class="row">
          <div>
            <strong>Edit Mode</strong><div class="badge">Add/Delete tasks, change colors, manage sheet</div>
          </div>
          <button class="btn" id="goEdit">Start Edit</button>
        </div>
      </div>
      <div class="card">
        <div class="row">
          <div>
            <strong>View Mode</strong><div class="badge">View & check the sheet; Print sheet only</div>
          </div>
          <button class="btn ghost" id="goView">Open View</button>
        </div>
      </div>
    </div>

    <!-- EDIT PAGE -->
    <section id="editPage" class="hidden">
      <!-- Theme & color controls -->
      <div class="controls card">
        <div class="tile">
          <span>Start</span><input type="color" id="c1" value="#0ea5e9">
          <span>End</span><input type="color" id="c2" value="#22c55e">
          <span>Angle</span><input type="range" id="angle" min="0" max="360" value="135"><span id="angleVal">135¬∞</span>
          <div class="swatch" title="Preview"></div>
          <button class="icon-btn" id="genGrad" title="Generate gradient">üé® Generate</button>
          <button class="btn small" id="applyGrad">Apply</button>
        </div>
        <div class="tile">
          <span>Page BG</span><input type="color" id="pageBg">
          <button class="icon-btn" id="resetTheme" title="Reset theme">‚Ü∫ Reset</button>
        </div>
        <div class="tile">
          <button class="icon-btn" id="exportPrint1" title="Print sheet only">üñ®Ô∏è Print</button>
        </div>
      </div>

      <!-- Task manager -->
      <div class="taskbar">
        <input id="newTask" type="text" placeholder="Add new task (e.g., Running, Journaling)" />
        <button class="btn small" id="addTask">Add Task</button>
        <span class="badge">Click a habit name to toggle whole row ‚Ä¢ Click a day number to toggle the column</span>
      </div>

      <!-- Sheet -->
      <div id="sheetCard1" class="board printable">
        <div class="board-header">
          <div class="progress" role="progressbar"><i id="overallBar1"></i></div>
          <div class="pct" id="overallPct1">0%</div>
        </div>
        <div id="sheet1" class="sheet" role="table" aria-label="Editable sheet"></div>
        <div class="legend">
          <span>‚úîÔ∏è Autosaves in your browser</span>
          <span>‚ûï Use Add Task to insert new rows</span>
          <span>üóëÔ∏è Use ‚ÄúDelete‚Äù on a task row to remove it (with confirmation)</span>
        </div>
      </div>
    </section>

    <!-- VIEW PAGE -->
    <section id="viewPage" class="hidden">
      <div class="card" style="margin-bottom:10px; display:flex; gap:10px; padding:10px; align-items:center; justify-content:space-between">
        <div class="badge">View Mode ‚Äî sheet only; no editing controls</div>
        <div>
          <button class="icon-btn" id="exportPrint2" title="Print sheet only">üñ®Ô∏è Print</button>
        </div>
      </div>

      <div id="sheetCard2" class="board printable">
        <div class="board-header">
          <div class="progress" role="progressbar"><i id="overallBar2"></i></div>
          <div class="pct" id="overallPct2">0%</div>
        </div>
        <div id="sheet2" class="sheet" role="table" aria-label="View sheet"></div>
        <div class="legend"><span>üñ®Ô∏è The Print button prints only this sheet.</span></div>
      </div>
    </section>
  </div>

<script>
(() => {
  const DAYS = 30;
  const STORAGE_KEY = "habit-tracker-pro-v4";
  const THEME_KEY = STORAGE_KEY + ":theme";
  const PREF_KEY  = STORAGE_KEY + ":pref";

  // Default tasks (with 5 prayers)
  const DEFAULT_TASKS = [
    "Fajr","Zohr","Asr","Maghrib","Isha",
    "Qur‚Äôan Pak Reading","Zikr / Ibadah","No Lust",
    "Remember an Ayat","Productive Work","Study","Workout","Exercise","Book Reading"
  ];

  /* ---------- Utilities ---------- */
  const qs = (s,p=document)=>p.querySelector(s);
  const qsa=(s,p=document)=>[...p.querySelectorAll(s)];
  const el=(t,c)=>{const e=document.createElement(t); if(c) e.className=c; return e};
  const state = {
    tasks: [],
    checks: {},    // key: rX-dY -> boolean
  };
  const pref = {
    theme:"dark"
  };

  function load(){
    try{
      const saved = JSON.parse(localStorage.getItem(STORAGE_KEY) || "null");
      if(saved && Array.isArray(saved.tasks)){
        state.tasks = saved.tasks;
        state.checks = saved.checks || {};
      }else{
        state.tasks = DEFAULT_TASKS.slice();
        state.checks = {};
      }
    }catch{
      state.tasks = DEFAULT_TASKS.slice();
      state.checks = {};
    }
    try{
      Object.assign(pref, JSON.parse(localStorage.getItem(PREF_KEY) || "{}"));
    }catch{}
  }
  function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }
  function savePref(){ localStorage.setItem(PREF_KEY, JSON.stringify(pref)); }

  function readTheme(){
    try{ return JSON.parse(localStorage.getItem(THEME_KEY) || "null"); }catch{ return null; }
  }
  function writeTheme(t){ localStorage.setItem(THEME_KEY, JSON.stringify(t)); }

  function setCSS(vars){
    for(const [k,v] of Object.entries(vars)){
      document.documentElement.style.setProperty(k, v);
    }
  }

  /* ---------- Theme & UI Prefs ---------- */
  function applyThemeFromStored(){
    const t = readTheme();
    if(t){
      setCSS({"--brand": t.c1, "--brand-2": t.c2, "--grad-angle": t.a+"deg", "--paper": t.pageBg || getVar("--paper")});
      if(t.light) document.documentElement.classList.add("light"); else document.documentElement.classList.remove("light");
      if(t.pageBg) document.body.style.backgroundColor = t.pageBg;
    }
  }
  function getVar(name){ return getComputedStyle(document.documentElement).getPropertyValue(name).trim(); }

  /* ---------- Build Sheet ---------- */
  function buildSheet(targetId, allowDelete=false){
    const sheet = qs("#"+targetId);
    sheet.innerHTML = "";

    // Header corner
    const corner = el("div","cell head name");
    corner.textContent = allowDelete ? "Habit / Day (Edit)" : "Habit / Day";
    sheet.appendChild(corner);

    // Day headers
    for(let d=1; d<=DAYS; d++){
      const c = el("div","cell head day");
      c.dataset.col=d; c.textContent=d;
      if(d%7===0) c.classList.add("weekhead");
      sheet.appendChild(c);
    }

    // Rows
    state.tasks.forEach((task, r)=>{
      const nameCell = el("div","cell name");
      nameCell.dataset.row=r;
      const lbl = el("span","label"); lbl.textContent = task;
      const rowpct = el("span","rowpct"); rowpct.textContent="0%";
      nameCell.append(lbl,rowpct);

      if(allowDelete){
        const del = el("button","icon-btn"); del.textContent="Delete";
        del.title="Delete this task";
        del.style.marginLeft="8px";
        del.addEventListener("click", ()=>{
          if(confirm(`Delete "${task}" and its checkmarks?`)){
            // remove row checks
            for(let d=1; d<=DAYS; d++) delete state.checks[key(r,d)];
            // remove task
            state.tasks.splice(r,1);
            save();
            renderAll();
          }
        });
        nameCell.appendChild(del);
      }
      sheet.appendChild(nameCell);

      for(let d=1; d<=DAYS; d++){
        const cell = el("div","cell"+(d%7===0?" week":""));
        const fb = el("label","fullbox");
        const cb = el("input"); cb.type="checkbox"; cb.id=key(r,d);
        cb.checked = !!state.checks[cb.id];
        const box = el("span","box");
        fb.append(cb,box);
        cell.appendChild(fb);
        sheet.appendChild(cell);
      }
    });

    // listeners
    sheet.addEventListener("change", e=>{
      if(e.target.type==="checkbox"){
        state.checks[e.target.id] = e.target.checked;
        save(); updateProgressBars();
      }
    });
    // toggles
    sheet.addEventListener("click", e=>{
      const head = e.target.closest(".cell.head.day");
      if(head){
        toggleColumn(Number(head.dataset.col));
        updateProgressBars();
      }
      const name = e.target.closest(".cell.name .label");
      if(name){
        const r = Number(name.parentElement.dataset.row);
        toggleRow(r);
        updateProgressBars();
      }
    });
  }

  const key = (r,c)=>`r${r}-d${c}`;

  function toggleRow(r){
    const all = [];
    for(let d=1; d<=DAYS; d++){ all.push(key(r,d)); }
    const everyChecked = all.every(k=>!!state.checks[k]);
    all.forEach(k=> state.checks[k] = !everyChecked);
    save();
    // update DOM
    all.forEach(k=> {
      const el = document.getElementById(k);
      if(el) el.checked = !!state.checks[k];
    });
  }
  function toggleColumn(c){
    const ids = state.tasks.map((_,r)=> key(r,c));
    const everyChecked = ids.every(k=>!!state.checks[k]);
    ids.forEach(k=> state.checks[k] = !everyChecked);
    save();
    ids.forEach(k=>{
      const el = document.getElementById(k);
      if(el) el.checked = !!state.checks[k];
    });
  }

  /* ---------- Progress ---------- */
  function updateProgressBars(){
    const checkboxes = qsa('input[type="checkbox"]');
    const total = checkboxes.length;
    const checked = checkboxes.filter(x=>x.checked).length;
    const pct = total? Math.round(checked/total*100) : 0;
    // bars
    [["overallBar1","overallPct1"],["overallBar2","overallPct2"]].forEach(([bar,txt])=>{
      const b = qs("#"+bar); const t = qs("#"+txt);
      if(b) b.style.width = pct+"%";
      if(t) t.textContent = pct+"%";
    });
    // per row
    state.tasks.forEach((_,r)=>{
      const rowBoxes = [];
      for(let d=1; d<=DAYS; d++){
        const el = document.getElementById(key(r,d));
        if(el) rowBoxes.push(el);
      }
      const p = rowBoxes.length ? Math.round(rowBoxes.filter(b=>b.checked).length/rowBoxes.length*100) : 0;
      qsa(`.cell.name[data-row="${r}"] .rowpct`).forEach(n=> n.textContent = p+"%");
    });
  }

  /* ---------- Rendering both pages ---------- */
  function renderAll(){
    buildSheet("sheet1", true);
    buildSheet("sheet2", false);
    updateProgressBars();
  }

  /* ---------- Mode switching ---------- */
  function show(sectionId){
    qs("#modePicker").classList.add("hidden");
    qs("#editPage").classList.add("hidden");
    qs("#viewPage").classList.add("hidden");
    qs("#"+sectionId).classList.remove("hidden");
  }

  /* ---------- Print only sheet ---------- */
  function printSheet(sheetCardId){
    // Ensure only that card has "printable" (already set), trigger print
    window.print();
  }

  /* ---------- Fullscreen ---------- */
  function toggleFullscreen(){
    const root = document.documentElement;
    if(!document.fullscreenElement){ root.requestFullscreen?.(); }
    else{ document.exitFullscreen?.(); }
  }

  /* ---------- Event wiring ---------- */
  function wire(){
    // Mode buttons
    qs("#goEdit").onclick = ()=> show("editPage");
    qs("#goView").onclick = ()=> show("viewPage");
    qs("#modeEditBtn").onclick = ()=> show("editPage");
    qs("#modeViewBtn").onclick = ()=> show("viewPage");

    // Print buttons (sheet only)
    qs("#exportPrint1").onclick = ()=> printSheet("sheetCard1");
    qs("#exportPrint2").onclick = ()=> printSheet("sheetCard2");

    // Theme toggle
    qs("#toggleTheme").onclick = ()=>{
      const root = document.documentElement;
      root.classList.toggle("light");
      pref.theme = root.classList.contains("light") ? "light" : "dark";
      savePref();
    };

    // Fullscreen
    qs("#fullscreenBtn").onclick = toggleFullscreen;

    // Gradient controls
    const c1=qs("#c1"), c2=qs("#c2"), ang=qs("#angle"), aVal=qs("#angleVal"), sw=qs(".swatch");
    function updPreview(){
      sw.style.background = `linear-gradient(${ang.value}deg, ${c1.value}, ${c2.value})`;
      aVal.textContent = ang.value+"¬∞";
    }
    ["input","change"].forEach(e=>{
      c1.addEventListener(e,updPreview); c2.addEventListener(e,updPreview); ang.addEventListener(e,updPreview);
    });
    qs("#applyGrad").onclick = ()=>{
      setCSS({"--brand":c1.value,"--brand-2":c2.value,"--grad-angle":ang.value+"deg"});
      const t = readTheme() || {};
      writeTheme({...t, c1:c1.value, c2:c2.value, a:Number(ang.value), pageBg: t.pageBg, light: document.documentElement.classList.contains("light")});
    };
    qs("#genGrad").onclick = ()=>{
      const rnd = ()=>"#"+Math.floor(Math.random()*0xffffff).toString(16).padStart(6,"0");
      c1.value=rnd(); c2.value=rnd(); ang.value=Math.floor(Math.random()*361); updPreview();
      qs("#applyGrad").click();
    };

    // Page background
    const pageBg = qs("#pageBg");
    const themeSaved = readTheme();
    pageBg.value = themeSaved?.pageBg || rgbToHex(window.getComputedStyle(document.body).backgroundColor) || "#0f172a";
    pageBg.addEventListener("input", ()=>{
      document.body.style.backgroundColor = pageBg.value;
      const t = readTheme() || {};
      writeTheme({...t, pageBg: pageBg.value, c1: getVar("--brand"), c2:getVar("--brand-2"), a: parseInt(getVar("--grad-angle"))||135, light: document.documentElement.classList.contains("light")});
    });

    // Reset theme
    qs("#resetTheme").onclick = ()=>{
      document.documentElement.classList.remove("light");
      setCSS({"--brand":"#0ea5e9","--brand-2":"#22c55e","--grad-angle":"135deg"});
      document.body.style.backgroundColor = "";
      writeTheme({c1:"#0ea5e9", c2:"#22c55e", a:135, pageBg:null, light:false});
      pageBg.value = rgbToHex(window.getComputedStyle(document.body).backgroundColor) || "#0f172a";
      updPreview();
    };

    // Add Task
    qs("#addTask").onclick = ()=>{
      const val = qs("#newTask").value.trim();
      if(!val) return;
      state.tasks.push(val);
      qs("#newTask").value="";
      save();
      renderAll();
    };

    // Enter to add
    qs("#newTask").addEventListener("keydown", e=>{
      if(e.key==="Enter"){ e.preventDefault(); qs("#addTask").click(); }
    });
  }

  function rgbToHex(rgb){
    // "rgb(15, 23, 42)" -> "#0f172a"
    const m = String(rgb).match(/(\d+),\s*(\d+),\s*(\d+)/);
    if(!m) return null;
    return "#"+[m[1],m[2],m[3]].map(x=> Number(x).toString(16).padStart(2,"0")).join("");
  }

  /* ---------- Init ---------- */
  load();
  applyThemeFromStored();
  renderAll();
  wire();

})();
</script>
</body>
</html>
